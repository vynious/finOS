id: "youtrip-digest"
issuer: "YouTrip"

detect:
  from_contains:
    - "@you.co"
    - "mail.you.co"
  subject_re: "(?i)\\b(online purchase|atm (withdrawal|transaction)|spending|card.*payment|transaction alert)\\b"

extract:
  # Preprocess before regex:
  # 1) HTML decode
  # 2) Strip tags
  # 3) Collapse whitespace to single spaces
  # 4) Replace "~" with ", " (optional)
  patterns:
    # Single robust matcher: merchant + currency + amount (case-insensitive, dot matches newline)
    - >-
      (?is)
      (?P<merchant>.+?)\s+
      (?P<currency>EUR|USD|SGD|GBP|[A-Z]{3}|[$€£])\s*
      (?P<amount>\d{1,3}(?:[.,]\d{3})*(?:[.,]\d{2})?)
normalize:
  currency_from_symbol: true
  decimal_heuristics: "eu-vs-us"
  # tz: "Asia/Singapore"   # ← safe to remove if you don't emit time
  # (Optionally enforce preprocessing if your pipeline supports it)
  # collapse_whitespace: true
  # replace:
  #   "~": ", "