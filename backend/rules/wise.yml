id: "wise-spend"
issuer: "Wise"

detect:
  from_contains: ["@wise.com", "@transferwise.com"]
  subject_re: "(?i)\\bspent\\b|\\byou spent\\b"
extract:
  patterns:
    - "(?i)\\byou\\s+spent\\s+(?P<amount>[0-9][0-9., ]*)\\s*(?P<currency>[A-Z]{3}|[€$£])\\s+at\\s+(?P<merchant>.+?)[\\.!]"
    # Subject form: "1.47 EUR spent at Despar"
    - "(?i)^(?P<amount>[0-9][0-9., ]*)\\s*(?P<currency>[A-Z]{3}|[€$£])\\s+spent\\s+at\\s+(?P<merchant>.+)$"
    # Backup: "spent at X for 12.34 EUR"
    - "(?i)spent\\s+at\\s+(?P<merchant>.+?)\\s+(for|-|-)\\s*(?P<amount>[0-9][0-9., ]*)\\s*(?P<currency>[A-Z]{3}|[€$£])"

  # Optional extractions (date/time lines). These are parsed if present.
  extras:
    date_line_re: "(?i)made\\s+at\\s+(?P<time>[0-9]{1,2}:[0-9]{2})\\s*\\((?P<tz>[A-Z]{2,5})\\)\\s+on\\s+(?P<date>[0-9]{1,2}\\s+[A-Za-z]+\\s+[0-9]{4})"

normalize:
  currency_from_symbol: true   # map €, $, £ → EUR/USD/GBP
  decimal_heuristics: "eu-vs-us"
  tz_fallback: "Europe/Rome"   # if tz missing
  merchant:
    # optional cleanups
    collapse_spaces: true
    strip_trailing_dot: true
  amount:
    min: 0.00
